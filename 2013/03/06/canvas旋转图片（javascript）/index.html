<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> canvas旋转图片（javascript） · Perpetual motion</title><meta name="description" content="canvas旋转图片（javascript） - null"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Perpetual motion"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">canvas旋转图片（javascript）</h1><div class="post-info">Mar 6, 2013</div><div class="post-content"><p>最近在项目中需要用canvas旋转图片，这方面一开始也比较不懂。找了很多的资料才搞定这个问题。主要用到了三个函数，translate、rotate、drawImage。</p>
<ul>
<li>translate(x,y)：移动画布坐标系统，x和y表示水平和竖直方向的偏移量。</li>
<li>rotate(reg)：旋转图片，reg表示旋转的度数。比如：Math.PI/4 表示为45。</li>
<li>drawImage(source,sx,sy,sh,sw,dx,dy,dh,dw)：将图片加载到画布上。source表示的图片的对象，sx和sy表示距图片圆点的偏移量，sh和sw表示加载图片的长度和宽度。dx和dy：距画布原点的偏移量，dh和dw：利用画布宽度和高度。</li>
</ul>
<p>现在我们要将旋转一张图片，顺时针进行旋转。</p>
<p>首先要在HTML上面增加一个canvas元素 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"test"</span> <span class="attr">width</span>=<span class="string">"120"</span> <span class="attr">height</span>=<span class="string">"120"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div></pre></td></tr></table></figure>
<p>然后需要在JavaScript中获取这个canvas</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> canvasObj = <span class="built_in">document</span>.getElementById(<span class="string">"test"</span>);</div></pre></td></tr></table></figure>
<p>下面我们则要返回canvas绘图环境</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> cxt = canvasObj.getContext(<span class="string">"2d"</span>); <span class="comment">//2d表示用二维的方式</span></div></pre></td></tr></table></figure>
<p>这时候我们要给这个画布设定一个旋转中心点。不过这个地方要重点说一下，图片一般都是长方形的。如果画布也设置成长方形的话。旋转过程中，有一部分图片会被截取掉。所以当图片为长方形的时候，我们先要将以图片最大尺寸的边来设置画布的长度和宽度。比如一张图片是200<em>100，那我们的画布必须是200</em>200。这样旋转的时候，才不会被截断。<br><a id="more"></a><br>设置中心点，就是用上面说的translate方法，x和y设置成正方形的中心点。比如200<em>200的画布，中心点则是100</em>100</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cxt.translate(<span class="number">100</span>,<span class="number">100</span>);</div></pre></td></tr></table></figure>
<p> 设置好中心点以后，我需要将画布进行旋转。 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cxt.rotate((<span class="number">2</span>*<span class="built_in">Math</span>.PI)<span class="comment">/*4); //旋转90度</span></div></pre></td></tr></table></figure>
<p> 然后我们增加一个图片对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image(); </div><div class="line">img.src = <span class="string">"baidu_jgylogo3.gif"</span>;</div><div class="line">img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	cxt.drawImage(<span class="keyword">this</span>,<span class="number">-100</span>,<span class="number">-100</span>); <span class="comment">//-100和translate的正向100，相互抵消。从而使图片的原点和画布的原点重合。         </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样就完成图片旋转的功能。</p>
<p>代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> c = <span class="built_in">document</span>.getElementById(<span class="string">"myCanvas"</span>);  </div><div class="line"><span class="keyword">var</span> cxt = c.getContext(<span class="string">"2d"</span>);  </div><div class="line">cxt.translate(<span class="number">58</span>,<span class="number">58</span>);  </div><div class="line">cxt.rotate( <span class="number">2</span> * (<span class="built_in">Math</span>.PI / <span class="number">2</span>));  </div><div class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();  </div><div class="line">img.src = <span class="string">"baidu_jgylogo3.gif"</span>;  </div><div class="line">img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;    </div><div class="line">    cxt.drawImage(img,<span class="number">-58</span>,<span class="number">-58</span>);   </div><div class="line">    cxt.save();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2013/03/21/inline-block和float的区别和分析/" class="prev">上一篇</a><a href="/2013/01/18/手机开发切图相关总结/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://yoursite.com"></a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>