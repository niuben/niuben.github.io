<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> webpack2 主要新功能介绍 · Perpetual motion</title><meta name="description" content="webpack2 主要新功能介绍 - null"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Perpetual motion"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">webpack2 主要新功能介绍</h1><div class="post-info">Feb 19, 2017</div><div class="post-content"><p>最近webpack2正式发布，推出一些很不错的新功能。下面具体介绍一下</p>
<h3 id="默认支持ES6"><a href="#默认支持ES6" class="headerlink" title="默认支持ES6"></a>默认支持ES6</h3><p>webpack2增加对ES6支持。当使用<code>import</code>和<code>export</code>的写法时，不再需要借助babel进行编译，而且还可以使用另一个新功能<code>tree-shaking</code>。</p>
<p>如果正在使用babel将<code>import</code>和<code>export</code>转化成<code>require</code>格式，可以通过修改<code>.babelrc</code>的<code>preset</code>选项进行关闭。设置如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//.babelrc文件</span></div><div class="line">&#123;</div><div class="line">    <span class="string">"presets"</span>: [</div><div class="line">        <span class="string">"env"</span>, </div><div class="line">        &#123;<span class="string">"modules"</span>: <span class="literal">false</span>&#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="tree-shaking"><a href="#tree-shaking" class="headerlink" title="tree-shaking"></a>tree-shaking</h3><p>因为可以静态分析ES6<code>import</code>和<code>export</code>，所以webpck可以标记没有被<code>import</code>使用的代码。webpack在压缩混淆代码时会删除没有使用的代码，从而产生更小的bundle代码。<br>举个官方例子说明一下：maths.js模块具有square和cube两个方法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// maths.js</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">square</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> x * x;</div><div class="line">&#125;</div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">cube</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> x * x * x;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>main.js只有引入maths.js模块cube方法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.js</span></div><div class="line"><span class="keyword">import</span> &#123;cube&#125; <span class="keyword">from</span> <span class="string">'./maths.js'</span>;</div><div class="line"><span class="built_in">console</span>.log(cube(<span class="number">5</span>)); <span class="comment">// 125</span></div></pre></td></tr></table></figure></p>
<p>执行<code>webpack -p main.js dist.min.js</code>命令，生成一个dist.min.js文件，打开并解压缩文件。内容如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//dist.min.js</span></div><div class="line">....</div><div class="line">function(e, t, n) &#123;</div><div class="line">    <span class="string">"use strict"</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> e * e * e</div><div class="line">    &#125;</div><div class="line">    t.a = r</div><div class="line">&#125;</div><div class="line">.....</div></pre></td></tr></table></figure></p>
<p>最终生产代码中maths.js模块只有<code>cube</code>方法，删除没有被调用的<code>square</code>方法。</p>
<h3 id="将module-loaders改成module-rules"><a href="#将module-loaders改成module-rules" class="headerlink" title="将module.loaders改成module.rules"></a>将module.loaders改成module.rules</h3><p><strong>webpack2在loader的灵活性和配置方面有很大的改进</strong>，包括可以在<code>option</code>属性中设置函数、新增条件匹配属性<code>issuer</code>、强制webpack对<code>pre-loader</code>分析从而减少编译时间的能力和执行<code>module</code>一致性等。</p>
<p>下面通过设置webpack2配置来解析<code>less</code>文件：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//webpack.config.js</span></div><div class="line">......</div><div class="line">module: &#123;</div><div class="line">    <span class="attr">rules</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</div><div class="line">            <span class="attr">use</span>: [</div><div class="line">                <span class="string">'style-loader'</span>,</div><div class="line">                &#123; <span class="attr">loader</span>: <span class="string">'css-loader'</span>, <span class="attr">options</span>: &#123; <span class="attr">importLoaders</span>: <span class="number">1</span> &#125; &#125;,</div><div class="line">                <span class="string">'less-loader'</span></div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div><div class="line">......</div></pre></td></tr></table></figure></p>
<h3 id="Performance-Budgets"><a href="#Performance-Budgets" class="headerlink" title="Performance Budgets"></a>Performance Budgets</h3><p>由于Web应用越来越复杂引入第三方库也越来越多，导致最后bundle文件越来越大。越来越大bundle文件会导致很多问题：请求文件时间变长、解析文件时间变长、页面展示时间变长等等。webpack2推出 Perfocemance Budgets 功能：当bundle文件过大时会显示警告或者错误信息。</p>
<p>可以设置 Performance Budgets 文件大小的最大值。当bundle文件超过最大值后还可以设置出<code>warning</code>或者<code>error</code>提示。出现<code>warning</code>时不影响打包进程，但出现<code>error</code>是会立即终止打包进程，所以官方建议在开发环境下设置<code>warning</code>提示，而在生产环境下设置成<code>error</code>提示。</p>
<p>下面例子设置入口文件和静态资源最大值约为500KB，超过最大值会出<code>warning</code>提示：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//webpack.config.js</span></div><div class="line">......</div><div class="line">performance: &#123;</div><div class="line">    <span class="attr">hints</span>: <span class="string">"warning"</span>,</div><div class="line">    <span class="attr">maxEntrypointSize</span>: <span class="number">500000</span>, <span class="comment">//bytes,</span></div><div class="line">    maxAssetSize: <span class="number">500000</span> <span class="comment">//bytes</span></div><div class="line">&#125;</div><div class="line">......</div></pre></td></tr></table></figure></p>
<h3 id="其他新的功能"><a href="#其他新的功能" class="headerlink" title="其他新的功能"></a>其他新的功能</h3><ul>
<li>通过<code>import()</code>方法lazy load ES6模块；</li>
<li>增强resolve功能；</li>
<li>UglifyJsPlugin默认开启<code>sourcemap</code>；</li>
<li>改变<code>pre-loader</code>和<code>post-loader</code>方式；</li>
<li>大大提高了打包的速度;</li>
<li><a href="https://webpack.js.org/guides/migrating/" target="_blank" rel="external">更多新功能……</a></li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>webpack2相比上一版本有质的变化，打包速度也大大提高。新项目完全可以大胆使用。虽然新版API绝大部分都支持旧版，但也有几个API接口废弃或者改名，老项目如果想从webpack1迁移到webpack2，需要花一些时间进行调试和修改配置文件。  </p>
<p>由于目前很多第三方库ES6版不完善，虽然tree-shaking功能对减小代码体积很有用，但是会让一些第三方库会出现缺失函数名或属性值相关的警告甚至报错，所以不管新项目还是老项目都要谨慎使用tree-shaking功能。</p>
<p><strong>总之webpack2是非常值得大家一试！</strong></p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/02/19/webpack md5入口html引入静态资源/" class="prev">PREV</a><a href="/2017/02/11/webpack2新功能之tree sharking/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://yoursite.com"></a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>